<!DOCTYPE html><html lang="zh-CN" data-theme="light"><head><meta charset="UTF-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0,viewport-fit=cover"><title>白话DDD入门 | Maple's  Blog</title><meta name="author" content="Maple"><meta name="copyright" content="Maple"><meta name="format-detection" content="telephone=no"><meta name="theme-color" content="#ffffff"><meta name="description" content="白话DDD入门 一个维护中的业务系统引出的思考这几年维护的一个带货类的项目，这个项目用了最传统的三层模型来搭建，大概是如下的模型：   当这个项目维护几年之后，逐渐出些了一些有意思的情况，如下： 情况 1（代码层面）：少部分代码可读性在长期不同人员的修改下变得越来越差。如：某个带货的核心 rpc 逻辑没有任何嵌套，平铺在一个函数里，单函数代码行数达到几百行，可读性和维护性极差，成功化身为“技术护城">
<meta property="og:type" content="article">
<meta property="og:title" content="白话DDD入门">
<meta property="og:url" content="https://maple8.github.io/2024/04/09/%E7%99%BD%E8%AF%9DDDD%E5%85%A5%E9%97%A8/index.html">
<meta property="og:site_name" content="Maple&#39;s  Blog">
<meta property="og:description" content="白话DDD入门 一个维护中的业务系统引出的思考这几年维护的一个带货类的项目，这个项目用了最传统的三层模型来搭建，大概是如下的模型：   当这个项目维护几年之后，逐渐出些了一些有意思的情况，如下： 情况 1（代码层面）：少部分代码可读性在长期不同人员的修改下变得越来越差。如：某个带货的核心 rpc 逻辑没有任何嵌套，平铺在一个函数里，单函数代码行数达到几百行，可读性和维护性极差，成功化身为“技术护城">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://maple8.github.io/top_img/ddd.jpg">
<meta property="article:published_time" content="2024-04-09T03:15:36.000Z">
<meta property="article:modified_time" content="2024-04-12T09:53:10.863Z">
<meta property="article:author" content="Maple">
<meta property="article:tag" content="DDD">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="https://maple8.github.io/top_img/ddd.jpg"><link rel="shortcut icon" href="/img/favicon.jpg"><link rel="canonical" href="https://maple8.github.io/2024/04/09/%E7%99%BD%E8%AF%9DDDD%E5%85%A5%E9%97%A8/index.html"><link rel="preconnect" href="//cdn.jsdelivr.net"/><link rel="stylesheet" href="/css/index.css"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free/css/all.min.css" media="print" onload="this.media='all'"><link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.min.css" media="print" onload="this.media='all'"><script>const GLOBAL_CONFIG = { 
  root: '/',
  algolia: undefined,
  localSearch: {"path":"/search.xml","preload":false,"top_n_per_article":1,"unescape":false,"languages":{"hits_empty":"找不到您查询的内容：${query}","hits_stats":"共找到 ${hits} 篇文章"}},
  translate: {"defaultEncoding":1,"translateDelay":0,"msgToTraditionalChinese":"繁","msgToSimplifiedChinese":"簡"},
  noticeOutdate: undefined,
  highlight: {"plugin":"highlighjs","highlightCopy":true,"highlightLang":true,"highlightHeightLimit":false},
  copy: {
    success: '复制成功',
    error: '复制错误',
    noSupport: '浏览器不支持'
  },
  relativeDate: {
    homepage: false,
    post: false
  },
  runtime: '',
  dateSuffix: {
    just: '刚刚',
    min: '分钟前',
    hour: '小时前',
    day: '天前',
    month: '个月前'
  },
  copyright: {"limitCount":22,"languages":{"author":"作者: Maple","link":"链接: ","source":"来源: Maple's  Blog","info":"著作权归作者所有。商业转载请联系作者获得授权，非商业转载请注明出处。"}},
  lightbox: 'fancybox',
  Snackbar: undefined,
  source: {
    justifiedGallery: {
      js: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.js',
      css: 'https://cdn.jsdelivr.net/npm/flickr-justified-gallery/dist/fjGallery.min.css'
    }
  },
  isPhotoFigcaption: false,
  islazyload: false,
  isAnchor: false,
  percent: {
    toc: true,
    rightside: true,
  }
}</script><script id="config-diff">var GLOBAL_CONFIG_SITE = {
  title: '白话DDD入门',
  isPost: true,
  isHome: false,
  isHighlightShrink: false,
  isToc: true,
  postUpdate: '2024-04-12 17:53:10'
}</script><noscript><style type="text/css">
  #nav {
    opacity: 1
  }
  .justified-gallery img {
    opacity: 1
  }

  #recent-posts time,
  #post-meta time {
    display: inline !important
  }
</style></noscript><script>(win=>{
    win.saveToLocal = {
      set: function setWithExpiry(key, value, ttl) {
        if (ttl === 0) return
        const now = new Date()
        const expiryDay = ttl * 86400000
        const item = {
          value: value,
          expiry: now.getTime() + expiryDay,
        }
        localStorage.setItem(key, JSON.stringify(item))
      },

      get: function getWithExpiry(key) {
        const itemStr = localStorage.getItem(key)

        if (!itemStr) {
          return undefined
        }
        const item = JSON.parse(itemStr)
        const now = new Date()

        if (now.getTime() > item.expiry) {
          localStorage.removeItem(key)
          return undefined
        }
        return item.value
      }
    }
  
    win.getScript = url => new Promise((resolve, reject) => {
      const script = document.createElement('script')
      script.src = url
      script.async = true
      script.onerror = reject
      script.onload = script.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        script.onload = script.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(script)
    })
  
    win.getCSS = (url,id = false) => new Promise((resolve, reject) => {
      const link = document.createElement('link')
      link.rel = 'stylesheet'
      link.href = url
      if (id) link.id = id
      link.onerror = reject
      link.onload = link.onreadystatechange = function() {
        const loadState = this.readyState
        if (loadState && loadState !== 'loaded' && loadState !== 'complete') return
        link.onload = link.onreadystatechange = null
        resolve()
      }
      document.head.appendChild(link)
    })
  
      win.activateDarkMode = function () {
        document.documentElement.setAttribute('data-theme', 'dark')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#0d0d0d')
        }
      }
      win.activateLightMode = function () {
        document.documentElement.setAttribute('data-theme', 'light')
        if (document.querySelector('meta[name="theme-color"]') !== null) {
          document.querySelector('meta[name="theme-color"]').setAttribute('content', '#ffffff')
        }
      }
      const t = saveToLocal.get('theme')
    
          if (t === 'dark') activateDarkMode()
          else if (t === 'light') activateLightMode()
        
      const asideStatus = saveToLocal.get('aside-status')
      if (asideStatus !== undefined) {
        if (asideStatus === 'hide') {
          document.documentElement.classList.add('hide-aside')
        } else {
          document.documentElement.classList.remove('hide-aside')
        }
      }
    
    const detectApple = () => {
      if(/iPad|iPhone|iPod|Macintosh/.test(navigator.userAgent)){
        document.documentElement.classList.add('apple')
      }
    }
    detectApple()
    })(window)</script><link rel="stylesheet" href="/css/maple_background.css"><meta name="generator" content="Hexo 5.4.2"></head><body><div id="loading-box"><div class="loading-left-bg"></div><div class="loading-right-bg"></div><div class="spinner-box"><div class="configure-border-1"><div class="configure-core"></div></div><div class="configure-border-2"><div class="configure-core"></div></div><div class="loading-word">加载中...</div></div></div><script>const preloader = {
  endLoading: () => {
    document.body.style.overflow = '';
    document.getElementById('loading-box').classList.add("loaded")
  },
  initLoading: () => {
    document.body.style.overflow = 'hidden';
    document.getElementById('loading-box').classList.remove("loaded")
  }
}

preloader.initLoading()
window.addEventListener('load',()=> { preloader.endLoading() })

if (false) {
  document.addEventListener('pjax:send', () => { preloader.initLoading() })
  document.addEventListener('pjax:complete', () => { preloader.endLoading() })
}</script><div id="sidebar"><div id="menu-mask"></div><div id="sidebar-menus"><div class="avatar-img is-center"><img src="/img/avatar1.jpeg" onerror="onerror=null;src='/img/friend_404.gif'" alt="avatar"/></div><div class="sidebar-site-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><hr/><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-blog"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-mug-hot"></i><span> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 摄影</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-running"></i><span> 体育</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/yuqiu/"><i class="fa-fw fas fa-volleyball-ball"></i><span> 羽毛球</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 笔者</span></a></div></div></div></div><div class="post" id="body-wrap"><header class="post-bg" id="page-header" style="background-image: url('/top_img/ddd.jpg')"><nav id="nav"><span id="blog-info"><a href="/" title="Maple's  Blog"><span class="site-name">Maple's  Blog</span></a></span><div id="menus"><div id="search-button"><a class="site-page social-icon search" href="javascript:void(0);"><i class="fas fa-search fa-fw"></i><span> 搜索</span></a></div><div class="menus_items"><div class="menus_item"><a class="site-page" href="/"><i class="fa-fw fas fa-home"></i><span> 首页</span></a></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-blog"></i><span> 博文</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/categories/"><i class="fa-fw fa fa-archive"></i><span> 分类</span></a></li><li><a class="site-page child" href="/tags/"><i class="fa-fw fa fa-tags"></i><span> 标签</span></a></li><li><a class="site-page child" href="/archives/"><i class="fa-fw fa fa-folder-open"></i><span> 归档</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-mug-hot"></i><span> 休闲</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/photos/"><i class="fa-fw fa fa-camera-retro"></i><span> 摄影</span></a></li><li><a class="site-page child" href="/movies/"><i class="fa-fw fas fa-video"></i><span> 电影</span></a></li></ul></div><div class="menus_item"><a class="site-page group" href="javascript:void(0);"><i class="fa-fw fas fa-running"></i><span> 体育</span><i class="fas fa-chevron-down"></i></a><ul class="menus_item_child"><li><a class="site-page child" href="/yuqiu/"><i class="fa-fw fas fa-volleyball-ball"></i><span> 羽毛球</span></a></li></ul></div><div class="menus_item"><a class="site-page" href="/about/"><i class="fa-fw fas fa-user"></i><span> 笔者</span></a></div></div><div id="toggle-menu"><a class="site-page" href="javascript:void(0);"><i class="fas fa-bars fa-fw"></i></a></div></div></nav><div id="post-info"><h1 class="post-title">白话DDD入门</h1><div id="post-meta"><div class="meta-firstline"><span class="post-meta-date"><i class="far fa-calendar-alt fa-fw post-meta-icon"></i><span class="post-meta-label">发表于</span><time class="post-meta-date-created" datetime="2024-04-09T03:15:36.000Z" title="发表于 2024-04-09 11:15:36">2024-04-09</time><span class="post-meta-separator">|</span><i class="fas fa-history fa-fw post-meta-icon"></i><span class="post-meta-label">更新于</span><time class="post-meta-date-updated" datetime="2024-04-12T09:53:10.863Z" title="更新于 2024-04-12 17:53:10">2024-04-12</time></span><span class="post-meta-categories"><span class="post-meta-separator">|</span><i class="fas fa-inbox fa-fw post-meta-icon"></i><a class="post-meta-categories" href="/categories/OOA-OOD/">OOA&amp;OOD</a></span></div><div class="meta-secondline"></div></div></div></header><main class="layout" id="content-inner"><div id="post"><article class="post-content" id="article-container"><p>白话DDD入门</p>
<h3 id="一个维护中的业务系统引出的思考"><a href="#一个维护中的业务系统引出的思考" class="headerlink" title="一个维护中的业务系统引出的思考"></a>一个维护中的业务系统引出的思考</h3><p>这几年维护的一个带货类的项目，这个项目用了最传统的三层模型来搭建，大概是如下的模型：</p>
<img src="640.jpeg" alt="img" style="zoom:40%;">

<p>当这个项目维护几年之后，逐渐出些了一些有意思的情况，如下：</p>
<p><strong>情况 1（代码层面）：</strong>少部分代码可读性在长期不同人员的修改下变得越来越差。如：某个带货的核心 rpc 逻辑没有任何嵌套，平铺在一个函数里，单函数代码行数达到几百行，可读性和维护性极差，成功化身为“技术护城河”。</p>
<p><strong>情况 2（微服务层面）：</strong> 某些微服务初始职能划分较为简单，导致少量模块在后续快速的迭代中迅速膨胀。如：其中的 mp 模块，原本职能是用来承接 B 端门户的功能，当我们决定拆分这个庞大的模块时，这个模块已经承载了 204 个 rpc。过多的能力承担让它编译变慢、变成链路单点、改动较多、一旦出现问题影响较大。</p>
<p><strong>情况 3（业务团队层面）：</strong>带货项目会使用一些其他业务系统的接口和数据结构，当这些业务系统想要修改这些接口和数据结构的时候 ，偶尔可能没有察觉这里的依赖导致线上问题， 或者沟通过来发现耦合处比较多不容易改动。</p>
<p>对这个项目的维护引出了一些思考，在一个复杂业务系统中：代码结构要如何设计、微服务的横/纵向职能要如何划分、业务团队之间如何交互，才能持续在长期快速、多人协作的迭代中保证系统可维护性、拓展性、高内聚低耦合和稳定性。</p>
<p>而传统的开发模式不管是<strong>面向过程（POP）</strong>还是<strong>面向对象（OOP）</strong>的思维，都没办法从微服务层面指导我们找到这些问题的答案。这时想到了领域驱动设计（DDD）。</p>
<h3 id="DDD-的分层架构"><a href="#DDD-的分层架构" class="headerlink" title="DDD 的分层架构"></a><strong>DDD 的分层架构</strong></h3><p>DDD 最有标志性的一点，就是将传统软件设计三层模型转化为了四层模型，这个转化如下图所示：</p>
<img src="640-20240409112814048.jpeg" alt="img" style="zoom:50%;">

<p>乍看之下，四层架构引入了很多概念，如：领域服务、领域对象、 DTO、仓储等等。我们先不用在意这些细节概念，先关注这几个关键的层：<strong>用户界面层、应用层、领域层、基础设施层</strong>。我们来看下他们的职能分工：</p>
<ul>
<li>用户界面层：网络协议的转化/统一鉴权/Session 管理/限流配置/前置缓存/异常转换</li>
<li>应用层：<strong>业务流程编排（仅编排，不能存在业务逻辑）</strong>/ DTO 出入转化</li>
<li>领域层：领域模型/领域服务/仓储和防腐层的接口定义</li>
<li>基础设施层：仓储和防腐层接口实现/存储等基础层能力</li>
</ul>
<p>这里必须要说的是，<strong>这四层不一定是指物理四层，也可以在一个微服务中拆分逻辑四层</strong>。四层架构有很多变种，如六边形架构、洋葱架构、整洁架构、清晰架构等等。这些繁多的概念我们这里不过多讨论，仅以洋葱架构为例，着重强调 DDD 中的<strong>依赖倒置（DIP）</strong>，以便后面更容易介绍仓储/防腐层等概念。</p>
<blockquote>
<p>依赖倒置(DIP)：<br>1.高级模块不应依赖于低级模块。两者都应依赖抽象。<br>2.抽象不应依赖细节。细节应依赖于抽象。</p>
</blockquote>
<img src="640-20240409112856427.jpeg" alt="img" style="zoom:40%;">

<p>如上，洋葱架构越往里依赖越低，越是核心能力。基础设施层在最外面，依赖其他层，这是是因为 DDD 中其他层等需要定义自己需要的基础能力接口，而基础设施层负责依赖并实现这些接口，从而实现整体依赖倒置。这体现了 DDD 的由全局入细微、自顶层向下层的设计思维。</p>
<h3 id="3-DDD-的概念和实践"><a href="#3-DDD-的概念和实践" class="headerlink" title="3.DDD 的概念和实践"></a><strong>3.DDD 的概念和实践</strong></h3><h4 id="1）战略和战术"><a href="#1）战略和战术" class="headerlink" title="1）战略和战术"></a>1）战略和战术</h4><p>DDD 的落地过程，其实就是<strong>战略建模</strong>和<strong>战术建模</strong>。</p>
<p><strong>战略建模</strong>，是指：通过 DDD 的理论，对业务需求进行拆解分析，划分子域，梳理限界上下文，通过领域语言从战略层面进行领域划分以及构建领域模型。并且在在构建领域模型的过程中梳理出业务对应的聚合、实体、以及值对象。</p>
<p><strong>战术建模</strong>，是指：以领域模型基础，通过限界上下文作为服务划分的边界进行微服务拆分，在每个微服务中进行领域分层，实现领域服务，从而实现领域模型对于代码映射目的，最终实现 DDD 的落地实施。</p>
<img src="640-20240409112939665.jpeg" alt="img" style="zoom:50%;">

<p>当然，战略和战术的建模除了要考虑业务形态，还要考虑到组织架构，就如同<strong>康威定律</strong>中的表达，<strong>沟通架构会影响技术架构</strong>。</p>
<blockquote>
<p>康威定律：任何组织在设计一套系统（广义概念上的系统）时，所交付的设计方案在结构上都与该组织的沟通结构保持一致。</p>
</blockquote>
<h4 id="2）领域"><a href="#2）领域" class="headerlink" title="2）领域"></a>2）领域</h4><p>DDD 在解决复杂的问题的时候，使用的是分而治之的思想。而这个分而治之的思想，就是从领域开始，一个领域就是一个问题空间，而我们在拆分这个问题空间的时候，也就是在划分子领域和寻找它的解系统的过程。</p>
<p><strong>实践例子：</strong></p>
<p>如我们某个新的增值业务，就是看成是的大的增值业务域，接下来我们通过 DDD 来指导拆分它。</p>
<img src="640-20240409113015146.jpeg" alt="img" style="zoom:33%;">

<h4 id="3）子域"><a href="#3）子域" class="headerlink" title="3）子域"></a><strong>3）子域</strong></h4><p>如果一个领域太大太复杂，涉及到的业务规则、交互流程、领域概念太多，就不能直接针对这个大的领域进行建模。这时就需要将领域进行拆分，本质上就是把大问题拆分为小问题，把一个大的领域划分为了多个小的领域（子域）。</p>
<p>子域可以分为三类：</p>
<p><strong>核心子域：</strong>业务成功的核心竞争力。</p>
<p><strong>通用子域：</strong>不是核心，但被整个业务系统所使用 。</p>
<p><strong>支撑子域：</strong>不是核心，不被整个系统使用，完成业务的必要能力。</p>
<p>子域的划分除了分治了大的问题空间，也划定了工作的优先级。我们应该给予核心域最高的优先级和最大的资源。在实施 DDD 的过程中，我们也是主要关注于核心域。</p>
<p><strong>实践例子：</strong></p>
<p>子域的划分，需要比较强的业务知识和产品研发集体讨论，准确和深入的业务见解在这一阶段尤为重要。这里我们不对业务知识深入讨论，仅展示下我们的对增值业务域的拆解结果。</p>
<img src="640-20240409113038722.jpeg" alt="img" style="zoom:50%;">

<p>这里要说的是，套餐域在实现的过程中由于产品需求变化概念被废弃了，但是由于我们的子域拆分，套餐域和其他域实现上没有任何耦合，所以废弃套餐域概念的废弃就像拆掉一个积木一样，对整套系统没有任何影响，也不会遗留任何不必要的包袱代码。</p>
<h4 id="4）限界上下文"><a href="#4）限界上下文" class="headerlink" title="4）限界上下文"></a><strong>4）限界上下文</strong></h4><p>要理解限界上下文，首先要先介绍通用语言。通用语言是 DDD 非常重要的一点。比如商品这个概念，在商品域里是指备上架的商品， 包含了 id、介绍、文档等。在交易域里其实是指订单中被交易的实体，关注的是 id、成交时刻的售价等参数、成交数量。而如果不能明确这些概念和他们的关系就会让开发人员的实现变的随心所欲和模糊。</p>
<p>而限界上下文是就是划分一个边界，当领域模型被一个显示的边界所包围时，其中每个概念的含义应该是明确且有唯一的含义。</p>
<p>我觉得初学者最常碰到的问题，肯定”明明已经有子域了，为什么还会有限界上下文这个概念”。子域是一个子问题空间，而限界上下文的作用是指导如何设计这个问题空间的解系统。换句话说，限界上下文才是真正用来指导微服务划分。一般来说一个子域对应一个或多个限界上下文。</p>
<p>划分限界上下文可以参考如下的规则：1） 概念是否有歧义：如果一个模型在一个上下文里面有歧义，就说明可以继续拆分限界上下文。</p>
<p>2）外部系统：可以把与外部系统交互的那部分拆分出去降低外部系统对我们我们的核心业务逻辑的影响。</p>
<p>3）组织架构：不同团队最好在不同的限界上下文里面开发，避免沟通不顺畅、集成困难等问题。可以参考上述”<strong>康威定律</strong>“。</p>
<p><strong>实践例子 1：</strong></p>
<p>如上所述，商品<strong>这个概念，是需要用限界上下文在不同场景区分开的。当然这也会导致两个限界上下文之间会有依赖。通过 DDD 的概念可以指导我们进行如下实现。</strong></p>
<img src="640-20240409113113094.jpeg" alt="img" style="zoom:50%;">

<p><strong>其中 gateway/gatewayimpl 是防腐层的实现，DTO 是指数据传输对象，APP 是指商品应用层。两个不同颜色的商品是指两个上下文中分别进行定义的不同的实体或值对象。</strong></p>
<p><strong>实践例子 2：</strong></p>
<p>交易域中，有两个订单的概念，其中第一个订单的概念是指业务层订单， 第二个订单的概念是指内部基础层订单。业务订单更关注发生交易的成交商品信息，这个订单是用户需要的。基础层订单更关注交易底层的过程信息，这个订单更多是我们内部人员需要的，用户不理解。</p>
<p>当时有个思路是想让基础层团队的同学额外开发直接支持基础层订单存储业务信息，这明显是不符合 DDD 限界上下文划分规则 1）和 3）的，是需要通过限界上下文解耦开的。所以我们在交易域中拆分两个上下文，后续从微服务层面也是相互独立的微服务，各自管理各自的领域实体和值对象。</p>
<img src="640-20240409113132990.jpeg" alt="img" style="zoom:50%;">

<h4 id="5）防腐层"><a href="#5）防腐层" class="headerlink" title="5）防腐层"></a><strong>5）防腐层</strong></h4><p>当两个限界上下文相互调用的时候，需使用防腐层（ACL）来进行两个限界上下文的隔离，并实现 value object 的转换。避免不同上下文直接互相调用，不然一旦被调用上下文被修改则可能产生较大影响。</p>
<p><strong>实践例子：</strong></p>
<p>实现链路可以参考 3.4 的例子 1，在商品域中，我们的防腐层是按照如下的目录方式实现的， 领域层来定义领域层需要的防腐接口，基础设施层继承并实现防腐接口，在基础设施层直接调用其他限界上下文。</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">productdomainsvr（商品限界上下文）</span><br><span class="line">├──domain（领域层）</span><br><span class="line">│├──aggregate</span><br><span class="line">││├──spu.cpp//1)spu领域对象需要调用其他限界上下文生成id</span><br><span class="line">││└──spu.h</span><br><span class="line">│└──gateway</span><br><span class="line">│└──gen_id_gateway.h//2)领域层定义调用其他限界上下文生成id的防腐接口</span><br><span class="line">├──infrastructure（基础设施层）</span><br><span class="line">│└──gatewayimpl</span><br><span class="line">│└──acl（防腐层）</span><br><span class="line">│├──gen_id_gateway_impl.cpp//3)基础设施层实现领域层定义的防腐接口，真实调用其他上下文</span><br><span class="line">│└──gen_id_gateway_impl.h</span><br></pre></td></tr></table></figure>

<h4 id="6）领域事件"><a href="#6）领域事件" class="headerlink" title="6）领域事件"></a><strong>6）领域事件</strong></h4><p>两个限界上下文除了通过使用防腐层直接调用，更多的时候是通过领域事件来进行解耦。</p>
<p>并不是所有领域中发生的事情都需要被建模为领域事件，我们只关注有业务价值的事情。领域事件是领域专家所关心的（需要跟踪的、希望被通知的、会引起其他模型对象改变状态的）发生在领域中的一些事情。</p>
<p>其实，领域事件的本质就是事件，我们常见的 kafka、wq 等都可以作为领域事件的实现基建。通过领域事件，可以把很轻松两个限界上下文解耦</p>
<p><strong>实践例子：</strong></p>
<p>在我们的增值业务中，交易域的”支付成功”就是一个领域事件，计费域订阅这个领域事件，从而可以根据这个事件调整客户的计费资源包实体。</p>
<img src="640-20240409113326891.jpeg" alt="img" style="zoom:50%;">

<p>可以想象，如果这里没有采用领域事件， 而是交易域直接调用计费域的 rpc 通知交易成功，那么当后续有其他域需要接受“支付成功”这个事件，或者，计费域被调用的接口出现故障。都会让交易域陷入麻烦，前者需要交易域不停的堆叠调用外部 rpc 的代码并让系统变得不稳定，后者则直接会让计费域的故障影响到用户交易。</p>
<h4 id="7）实体-值对象"><a href="#7）实体-值对象" class="headerlink" title="7）实体/值对象"></a><strong>7）实体/值对象</strong></h4><p><strong>实体是指上下文中唯一的且可持续变化的基础单元，在其生命周期中可以通过稳定的唯一 id 来标识。实体在我们代码中以领域对象的形态存在，同时具备属性和方法，实体是 DDD 用来实现充血编程、解决贫血症的关键。</strong></p>
<p><strong>与实体相对应的就是值对象，如果没有唯一标识就是值对象。值对象一般是嵌套在实体里面的。</strong></p>
<p><strong>实践例子：</strong></p>
<p>商品域中的实体和值对象如下</p>
<table>
<thead>
<tr>
<th align="left"><strong>实体</strong></th>
<th align="left"><strong>描述</strong></th>
<th align="left"><strong>关键值对象</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">SPU</td>
<td align="left">指一个被上架的服务。</td>
<td align="left">spu_id, spu_type，状态等。</td>
</tr>
<tr>
<td align="left">SKU</td>
<td align="left">指一个服务具体的单项套餐。</td>
<td align="left">sku_id, 规格，价格等。</td>
</tr>
<tr>
<td align="left">折扣</td>
<td align="left">自定义折扣。</td>
<td align="left">折扣 id，折扣类型，折扣比例等。</td>
</tr>
</tbody></table>
<h4 id="8）聚合-聚合根"><a href="#8）聚合-聚合根" class="headerlink" title="8）聚合/聚合根"></a><strong>8）聚合/聚合根</strong></h4><p>把关系紧密的实体放到一个聚合中，每个聚合中有一个实体作为聚合根，所有对于聚合内对象的访问都通过聚合根来进行，外部对象只能持有对聚合根的引用。每个聚合都可以有一个独立的上下文边界。</p>
<p>聚合应划分的尽量小，一个聚合只包含一个聚合根实体和密不可分的实体，实体中只包含最小数量的属性。设计这样的小聚合有助于进行后续微服务的拆分。</p>
<p>如果一个 rpc 所实现的功能是跨聚合的，那跨聚合的编排协调工作应该放在应用层来实现。</p>
<p><strong>实践例子：</strong></p>
<p>我们可以在 6)中的例子划分如下的聚合。</p>
<table>
<thead>
<tr>
<th align="left"><strong>聚合</strong></th>
<th align="left"><strong>实体</strong></th>
<th align="left"><strong>是否是根</strong></th>
</tr>
</thead>
<tbody><tr>
<td align="left">聚合 1</td>
<td align="left">服务 SPU</td>
<td align="left">是</td>
</tr>
<tr>
<td align="left">服务 SKU</td>
<td align="left">否</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">聚合 2</td>
<td align="left">折扣</td>
<td align="left">是</td>
</tr>
</tbody></table>
<p>在底层存储落表上， spu 实体/折扣实体作为表的一行， 而 sku 实体在这种聚合建模的指引下我们设计成 spu 聚合根的一列。</p>
<p>在微服务拆分上，如果想拆到最细粒度， 可以把两个聚合按照各自上下文拆成独立的微服务。当然这种落地实现并不是 DDD 强行要求的，我认为一些时候我们也可以从开发维护效率的角度考虑， 将一些有关联的小上下文放在一个为微服务上。我们在处理商品域上选择了后者。</p>
<h4 id="9）DTO-领域对象-Data-object"><a href="#9）DTO-领域对象-Data-object" class="headerlink" title="9）DTO/领域对象/Data object"></a><strong>9）DTO/领域对象/Data object</strong></h4><p>当一个请求进入 DDD 所设计的系统中，这个请求的形态会根据所在的层级发生如下变换，DTO&lt;-&gt;领域对象&lt;-&gt;Data object。</p>
<p>DTO 是指对外传输的其他服务需要理解的结构，领域对象是指同时包含了属性和方法的领域实体封装，Data object 则是真正用于最终存储的数据结构。</p>
<img src="640-20240409113416809.jpeg" alt="img" style="zoom:50%;">

<p>这里其实很容易发现，DTO 的存在虽然符合其他调用方<strong>最少知识原则（LKP）</strong>，但如果连最简单的查询请求都需要做这三级的转换，那无疑是会加重开发的复杂度，变成为了设计模式而设计模式。</p>
<blockquote>
<p>最少知识原则(迪米特法则，LKP):一个软件实体应当尽可能少地与其他实体发生相互作用。这里的软件实体是一个广义的概念，不仅包括对象，还包括系统、类、模块、函数、变量等。</p>
</blockquote>
<p>所以 DDD 在这里一般会使用 CQRS（读写责任分离）架构，来保证一些简单的查询请求不会因为领域建模而变得过于复杂。CQRS（读写责任分离）基于 CQS（读写分离），使用了 CQRS 的 DDD 对象转换流程如下：</p>
<img src="640-20240409113458599.jpeg" alt="img" style="zoom:50%;">

<p><strong>实践例子：</strong></p>
<p>我们的实现是在领域对象中封装了转换的 convert 函数（当然也可以在基础设施层将 convert 方法拆分出来做单独的封装），用于将 DTO 转换为领域对象，或者将领域对象转换为 DO。下面是我们明细域的实际转换代码和转换过程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.领域对象中定义convert方法</span></span><br><span class="line">classDetailRecord&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line">intConvertFromDTO(constgoogle::protobuf::Message&amp;oDto);</span><br><span class="line">intConvertToDO(detailrecordinfrastructure::DetailRecordDO&amp;oDo);</span><br><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//2.应用层调用方法将DTO转化为领域对象，然后调用仓储接口进行持久化</span></span><br><span class="line">intDetailrecordApplication::InsertDetailRecord(unsignedinthead_uin,constInsertDetailRecordReq&amp;req,InsertDetailRecordResp*resp)&#123;</span><br><span class="line">intiRet=<span class="number">0</span>;</span><br><span class="line">classDetailRecordoRecord;</span><br><span class="line">iRet=oRecord.ConvertFromDTO(req);<span class="comment">//生成领域对象，可以同时利用领域对象的方法进行自检等操作</span></span><br><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">iRet=m_oDetailRecordGateway-&gt;Save(oRecord);<span class="comment">//调用仓储接口进行持久化</span></span><br><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">returniRet;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//3.在仓储中将领域对象转化为Dataobject，进行落存储操作，并发布领域事件</span></span><br><span class="line">intDetailRecordGatewayImpl::Save(DetailRecord&amp;oEntity)&#123;</span><br><span class="line">detailrecordinfrastructure::DetailRecordDOoDo;</span><br><span class="line">intiRet=oEntity.ConvertToDO(oDo);</span><br><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">iRet=oKvMapper.insert(oDo);<span class="comment">//实际落存储</span></span><br><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">iRet=oEventMapper.publish(oDo);<span class="comment">//发送领域事件</span></span><br><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">returniRet;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="10）仓储"><a href="#10）仓储" class="headerlink" title="10）仓储"></a><strong>10）仓储</strong></h4><p><strong>仓储</strong>是领域层由定义接口，它抽象了业务逻辑中对实体的访问（包括读取和存储）的技术细节。它的作用就是通过隔离具体的存储层技术实现来保证业务逻辑的稳定性。注意，<strong>仓储只是接口的定义是在领域层，但是它的实现是在基础设施层</strong>。</p>
<p>仓储不是数据库 Dao！！！</p>
<p>仓储不是数据库 Dao！！！</p>
<p>仓储不是数据库 Dao！！！</p>
<p>重要的事情说三遍，仓储是从业务逻辑的角度抽象出来的接口，所以仓储的接口在实现上，一般是一个聚合对应一个仓储实现，仓储的需要用领域对象做参数。仓储接口的命名也可以取 save 这种更业务的命名， 而避免传统 dao 的 insert/set 等这种明明。</p>
<p><strong>实践例子：</strong></p>
<p>通过 3.9 的例子，我们可以发现，仓储用于持久化的接口里，不但包含了写 kv 的操作，还包含了发布领域事件等操作，这就是因为仓储是从业务逻辑角度抽象出来的接口，领域层只需要理解 save 这个业务操作，而不应该理解 save 的过程包含了落存储、发布领域事件等具体流程。</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//1.领域层定义DetailRecord仓储的接口</span></span><br><span class="line">classDetailRecordGateway&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">virtualintSave(DetailRecord&amp;oEntity)=<span class="number">0</span>;</span><br><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//2.基础设施层继承领域层的仓储接口进行实现</span></span><br><span class="line">classDetailRecordGatewayImpl:publicDetailRecordGateway&#123;</span><br><span class="line"><span class="keyword">public</span>:</span><br><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">virtualintSave(DetailRecord&amp;oEntity);</span><br><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">//3.仓储save接口具体实现</span></span><br><span class="line">intDetailRecordGatewayImpl::Save(DetailRecord&amp;oEntity)&#123;</span><br><span class="line">detailrecordinfrastructure::DetailRecordDOoDo;</span><br><span class="line">intiRet=oEntity.ConvertToDO(oDo);</span><br><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">iRet=oKvMapper.insert(oDo);<span class="comment">//实际落存储</span></span><br><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">iRet=oEventMapper.publish(oDo);<span class="comment">//发布领域事件</span></span><br><span class="line"><span class="comment">/*...*/</span></span><br><span class="line">returniRet;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="11）领域服务"><a href="#11）领域服务" class="headerlink" title="11）领域服务"></a><strong>11）领域服务</strong></h4><p>当一些能力不适合放在某个领域对象中实现，又因为过于复杂不应该放在应用层来实现。可以把这些操作封装成领域服务的中方法，由应用层编排领域层的领域对象和领域服务方法来完成具体的业务功能。</p>
<h3 id="4-DDD-的代码脚手架"><a href="#4-DDD-的代码脚手架" class="headerlink" title="4.DDD 的代码脚手架"></a><strong>4.DDD 的代码脚手架</strong></h3><p>我们基于对 DDD 的理解和 WXG 的 svrkit 框架，设定我们的代码脚手架。脚手架的目录如下所示，希望可以给想一起实践的同事抛砖引玉，也欢迎大家来找我们一起讨论：</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">项目目录</span><br><span class="line">├──adapter（物理用户界面模块）</span><br><span class="line">├──domainsvr（领域微服务）</span><br><span class="line">│├──detailrecorddomainsvr（明细域微服务）</span><br><span class="line">││├──adapter（用户界面层）</span><br><span class="line">││├──application（应用层）</span><br><span class="line">│││├──detailrecord_application.cpp（应用层方法）</span><br><span class="line">││├──domain（领域层）</span><br><span class="line">│││├──aggregate（聚合根）</span><br><span class="line">││││├──detail_record.cpp（领域对象）</span><br><span class="line">││││└──detailrecordaggregate.proto（聚合根的值对象）</span><br><span class="line">│││├──entity（非根实体）</span><br><span class="line">││││└──detailrecordentity.proto（非根实体的值对象）</span><br><span class="line">│││├──gateway</span><br><span class="line">││││└──detail_record_gateway.h（仓储接口）</span><br><span class="line">│││└──detailrecord_domain_service.cpp（领域服务）</span><br><span class="line">││├──infrastructure（基础设施层）</span><br><span class="line">│││├──gatewayimpl</span><br><span class="line">││││├──acl（防腐层实现）</span><br><span class="line">││││└──detail_record_gateway_impl.cpp（仓储实现）</span><br><span class="line">│││└──detailrecordinfrastructure.proto（Dataobject定义）</span><br><span class="line">││└──detailrecord.proto（DTO定义)</span><br><span class="line">└──infrastructuresvr（物理基础设施模块）</span><br></pre></td></tr></table></figure>

<hr>
<p><strong>参考文档：</strong></p>
<p><a target="_blank" rel="noopener" href="http://www.yitb.com/article-41463">后台开发进阶：白话DDD从入门到实践</a></p>
<hr>
</article><div class="post-copyright"><div class="post-copyright__author"><span class="post-copyright-meta">文章作者: </span><span class="post-copyright-info"><a href="https://maple8.github.io">Maple</a></span></div><div class="post-copyright__type"><span class="post-copyright-meta">文章链接: </span><span class="post-copyright-info"><a href="https://maple8.github.io/2024/04/09/%E7%99%BD%E8%AF%9DDDD%E5%85%A5%E9%97%A8/">https://maple8.github.io/2024/04/09/%E7%99%BD%E8%AF%9DDDD%E5%85%A5%E9%97%A8/</a></span></div><div class="post-copyright__notice"><span class="post-copyright-meta">版权声明: </span><span class="post-copyright-info">本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/" target="_blank">CC BY-NC-SA 4.0</a> 许可协议。转载请注明来自 <a href="https://maple8.github.io" target="_blank">Maple's  Blog</a>！</span></div></div><div class="tag_share"><div class="post-meta__tag-list"><a class="post-meta__tags" href="/tags/DDD/">DDD</a></div><div class="post_share"></div></div><div class="post-reward"><div class="reward-button"><i class="fas fa-qrcode"></i> 打赏</div><div class="reward-main"><ul class="reward-all"><li class="reward-item"><a href="/img/wechatpay.png" target="_blank"><img class="post-qr-code-img" src="/img/wechatpay.png" alt="微信"/></a><div class="post-qr-code-desc">微信</div></li></ul></div></div><nav class="pagination-post" id="pagination"><div class="prev-post pull-left"><a href="/2024/04/18/Git%E5%91%BD%E4%BB%A4/" title="Git命令"><img class="cover" src="https://static.is26.com/wp-image/2013/09/git_wallpaper_clean_by_black_pixel-d5wmjnw.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of previous post"><div class="pagination-info"><div class="label">上一篇</div><div class="prev_info">Git命令</div></div></a></div><div class="next-post pull-right"><a href="/2024/03/18/UML%E7%B1%BB%E9%97%B4%E5%85%B3%E7%B3%BB/" title="UML类间关系"><img class="cover" src="/top_img/ooad.jpg" onerror="onerror=null;src='/img/404.jpg'" alt="cover of next post"><div class="pagination-info"><div class="label">下一篇</div><div class="next_info">UML类间关系</div></div></a></div></nav></div><div class="aside-content" id="aside-content"><div class="card-widget card-info"><div class="is-center"><div class="avatar-img"><img src="/img/avatar1.jpeg" onerror="this.onerror=null;this.src='/img/friend_404.gif'" alt="avatar"/></div><div class="author-info__name">Maple</div><div class="author-info__description">一 切 都 是 最 好 的 安 排 !</div></div><div class="card-info-data site-data is-center"><a href="/archives/"><div class="headline">文章</div><div class="length-num">67</div></a><a href="/tags/"><div class="headline">标签</div><div class="length-num">42</div></a><a href="/categories/"><div class="headline">分类</div><div class="length-num">15</div></a></div><div class="card-info-social-icons is-center"><a class="social-icon" href="https://maple8.github.io/" target="_blank" title="Old Version Blog"><i class="fas fa-blog"></i></a><a class="social-icon" href="https://gitee.com/maple_eitba" target="_blank" title="Github"><i class="fab fa-github"></i></a><a class="social-icon" href="mailto:maple_eitba@163.com" target="_blank" title="Email"><i class="fas fa-envelope"></i></a><a class="social-icon" href="http://wpa.qq.com/msgrd?v=3&amp;uin=790379323&amp;site=qq&amp;menu=yes" target="_blank" title="QQ"><i class="fab fa-qq"></i></a></div></div><div class="sticky_layout"><div class="card-widget" id="card-toc"><div class="item-headline"><i class="fas fa-stream"></i><span>目录</span><span class="toc-percentage"></span></div><div class="toc-content"><ol class="toc"><li class="toc-item toc-level-3"><a class="toc-link" href="#%E4%B8%80%E4%B8%AA%E7%BB%B4%E6%8A%A4%E4%B8%AD%E7%9A%84%E4%B8%9A%E5%8A%A1%E7%B3%BB%E7%BB%9F%E5%BC%95%E5%87%BA%E7%9A%84%E6%80%9D%E8%80%83"><span class="toc-number">1.</span> <span class="toc-text">一个维护中的业务系统引出的思考</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#DDD-%E7%9A%84%E5%88%86%E5%B1%82%E6%9E%B6%E6%9E%84"><span class="toc-number">2.</span> <span class="toc-text">DDD 的分层架构</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#3-DDD-%E7%9A%84%E6%A6%82%E5%BF%B5%E5%92%8C%E5%AE%9E%E8%B7%B5"><span class="toc-number">3.</span> <span class="toc-text">3.DDD 的概念和实践</span></a><ol class="toc-child"><li class="toc-item toc-level-4"><a class="toc-link" href="#1%EF%BC%89%E6%88%98%E7%95%A5%E5%92%8C%E6%88%98%E6%9C%AF"><span class="toc-number">3.1.</span> <span class="toc-text">1）战略和战术</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#2%EF%BC%89%E9%A2%86%E5%9F%9F"><span class="toc-number">3.2.</span> <span class="toc-text">2）领域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#3%EF%BC%89%E5%AD%90%E5%9F%9F"><span class="toc-number">3.3.</span> <span class="toc-text">3）子域</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#4%EF%BC%89%E9%99%90%E7%95%8C%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="toc-number">3.4.</span> <span class="toc-text">4）限界上下文</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#5%EF%BC%89%E9%98%B2%E8%85%90%E5%B1%82"><span class="toc-number">3.5.</span> <span class="toc-text">5）防腐层</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#6%EF%BC%89%E9%A2%86%E5%9F%9F%E4%BA%8B%E4%BB%B6"><span class="toc-number">3.6.</span> <span class="toc-text">6）领域事件</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#7%EF%BC%89%E5%AE%9E%E4%BD%93-%E5%80%BC%E5%AF%B9%E8%B1%A1"><span class="toc-number">3.7.</span> <span class="toc-text">7）实体&#x2F;值对象</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#8%EF%BC%89%E8%81%9A%E5%90%88-%E8%81%9A%E5%90%88%E6%A0%B9"><span class="toc-number">3.8.</span> <span class="toc-text">8）聚合&#x2F;聚合根</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#9%EF%BC%89DTO-%E9%A2%86%E5%9F%9F%E5%AF%B9%E8%B1%A1-Data-object"><span class="toc-number">3.9.</span> <span class="toc-text">9）DTO&#x2F;领域对象&#x2F;Data object</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#10%EF%BC%89%E4%BB%93%E5%82%A8"><span class="toc-number">3.10.</span> <span class="toc-text">10）仓储</span></a></li><li class="toc-item toc-level-4"><a class="toc-link" href="#11%EF%BC%89%E9%A2%86%E5%9F%9F%E6%9C%8D%E5%8A%A1"><span class="toc-number">3.11.</span> <span class="toc-text">11）领域服务</span></a></li></ol></li><li class="toc-item toc-level-3"><a class="toc-link" href="#4-DDD-%E7%9A%84%E4%BB%A3%E7%A0%81%E8%84%9A%E6%89%8B%E6%9E%B6"><span class="toc-number">4.</span> <span class="toc-text">4.DDD 的代码脚手架</span></a></li></ol></div></div><div class="card-widget card-recent-post"><div class="item-headline"><i class="fas fa-history"></i><span>最新文章</span></div><div class="aside-list"><div class="aside-list-item"><a class="thumbnail" href="/2024/07/26/MySql-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3B-%E6%A0%91%E7%B4%A2%E5%BC%95/" title="MySql-深入理解B+树索引"><img src="/top_img/mysql.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySql-深入理解B+树索引"/></a><div class="content"><a class="title" href="/2024/07/26/MySql-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3B-%E6%A0%91%E7%B4%A2%E5%BC%95/" title="MySql-深入理解B+树索引">MySql-深入理解B+树索引</a><time datetime="2024-07-26T03:10:35.000Z" title="发表于 2024-07-26 11:10:35">2024-07-26</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/25/MySql-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3InnoDB%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="MySql-深入理解InnoDB数据结构"><img src="/top_img/mysql.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="MySql-深入理解InnoDB数据结构"/></a><div class="content"><a class="title" href="/2024/07/25/MySql-%E6%B7%B1%E5%85%A5%E7%90%86%E8%A7%A3InnoDB%E6%95%B0%E6%8D%AE%E7%BB%93%E6%9E%84/" title="MySql-深入理解InnoDB数据结构">MySql-深入理解InnoDB数据结构</a><time datetime="2024-07-25T09:53:10.000Z" title="发表于 2024-07-25 17:53:10">2024-07-25</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/23/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%B9%B3%E6%BB%91%E7%9A%84%E8%8A%82%E7%82%B9%E6%89%A9%E5%AE%B9%E6%96%B9%E6%A1%88/" title="数据库-平滑的节点扩容方案"><img src="/top_img/table.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据库-平滑的节点扩容方案"/></a><div class="content"><a class="title" href="/2024/07/23/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%B9%B3%E6%BB%91%E7%9A%84%E8%8A%82%E7%82%B9%E6%89%A9%E5%AE%B9%E6%96%B9%E6%A1%88/" title="数据库-平滑的节点扩容方案">数据库-平滑的节点扩容方案</a><time datetime="2024-07-23T09:13:51.000Z" title="发表于 2024-07-23 17:13:51">2024-07-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/23/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%85%A8%E5%B1%80%E8%A1%A8/" title="数据库-全局表"><img src="/top_img/table.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据库-全局表"/></a><div class="content"><a class="title" href="/2024/07/23/%E6%95%B0%E6%8D%AE%E5%BA%93-%E5%85%A8%E5%B1%80%E8%A1%A8/" title="数据库-全局表">数据库-全局表</a><time datetime="2024-07-23T07:50:44.000Z" title="发表于 2024-07-23 15:50:44">2024-07-23</time></div></div><div class="aside-list-item"><a class="thumbnail" href="/2024/07/23/%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%9D%83%E8%A1%A1%E8%8C%83%E5%BC%8F%E4%B8%8E%E5%8F%8D%E8%8C%83%E5%BC%8F%E8%AE%BE%E8%AE%A1/" title="数据库-权衡范式与反范式设计"><img src="/top_img/table.jpg" onerror="this.onerror=null;this.src='/img/404.jpg'" alt="数据库-权衡范式与反范式设计"/></a><div class="content"><a class="title" href="/2024/07/23/%E6%95%B0%E6%8D%AE%E5%BA%93-%E6%9D%83%E8%A1%A1%E8%8C%83%E5%BC%8F%E4%B8%8E%E5%8F%8D%E8%8C%83%E5%BC%8F%E8%AE%BE%E8%AE%A1/" title="数据库-权衡范式与反范式设计">数据库-权衡范式与反范式设计</a><time datetime="2024-07-23T02:06:08.000Z" title="发表于 2024-07-23 10:06:08">2024-07-23</time></div></div></div></div></div></div></main><footer id="footer"><div id="footer-wrap"><div class="copyright">&copy;2023 - 2024 By Maple</div><div class="footer_custom_text">一 切 都 是 最 好 的 安 排 !</div></div></footer></div><div id="rightside"><div id="rightside-config-hide"><button id="readmode" type="button" title="阅读模式"><i class="fas fa-book-open"></i></button><button id="translateLink" type="button" title="简繁转换">簡</button><button id="darkmode" type="button" title="浅色和深色模式转换"><i class="fas fa-adjust"></i></button><button id="hide-aside-btn" type="button" title="单栏和双栏切换"><i class="fas fa-arrows-alt-h"></i></button></div><div id="rightside-config-show"><button id="rightside_config" type="button" title="设置"><i class="fas fa-cog fa-spin"></i></button><button class="close" id="mobile-toc-button" type="button" title="目录"><i class="fas fa-list-ul"></i></button><button id="go-up" type="button" title="回到顶部"><span class="scroll-percent"></span><i class="fas fa-arrow-up"></i></button></div></div><div><script src="/js/utils.js"></script><script src="/js/main.js"></script><script src="/js/tw_cn.js"></script><script src="https://cdn.jsdelivr.net/npm/@fancyapps/ui/dist/fancybox/fancybox.umd.min.js"></script><div class="js-pjax"></div><script defer="defer" id="ribbon" src="https://cdn.jsdelivr.net/npm/butterfly-extsrc/dist/canvas-ribbon.min.js" size="150" alpha="0.6" zIndex="-1" mobile="true" data-click="true"></script><div id="local-search"><div class="search-dialog"><nav class="search-nav"><span class="search-dialog-title">搜索</span><span id="loading-status"></span><button class="search-close-button"><i class="fas fa-times"></i></button></nav><div class="is-center" id="loading-database"><i class="fas fa-spinner fa-pulse"></i><span>  数据库加载中</span></div><div class="search-wrap"><div id="local-search-input"><div class="local-search-box"><input class="local-search-box--input" placeholder="搜索文章" type="text"/></div></div><hr/><div class="no-result" id="local-search-results"></div><div id="local-search-stats-wrap"></div></div></div><div id="search-mask"></div><script src="/js/search/local-search.js"></script></div></div></body></html>